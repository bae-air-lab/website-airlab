<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Publications - AIR Lab</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config={theme:{extend:{colors:{gold:'#ba9731',navlight:'#DBE9F4'}}}}</script>
  <style>
    .theme-transition{transition:background-color .3s,color .3s}
    .dropdown-enter{animation:dropIn .15s ease-out}
    @keyframes dropIn{from{opacity:0;transform:translateY(-8px)}to{opacity:1;transform:translateY(0)}}
    .loader{border-top-color:#6b7280;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body class="m-0 p-0">

  <!-- NAVBAR -->
  <nav id="desktop-nav" class="hidden md:flex fixed top-4 left-1/2 -translate-x-1/2 z-50 bg-navlight text-black rounded-full py-3 px-7 items-center space-x-6 shadow-lg theme-transition">
    <div class="w-12 h-6 relative overflow-hidden flex-shrink-0"><a href="index.html"><img id="desktop-logo" src="logo_black.png" alt="AIR Lab Logo" class="w-full h-full object-cover"/></a></div>
    <div class="flex items-center space-x-8 pl-12">
      <a href="teams.html" class="hover:text-gray-600 transition">Teams</a><a href="gallery.html" class="hover:text-gray-600 transition">Gallery</a><a href="news.html" class="hover:text-gray-600 transition">News</a>
      <div class="relative" id="desktop-dropdown-wrapper">
        <button type="button" id="desktop-dropdown-btn" class="flex items-center cursor-pointer gap-1 hover:text-gray-600 transition focus:outline-none">Research<svg id="desktop-chevron" class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/></svg></button>
        <div id="desktop-dropdown" class="hidden dropdown-enter absolute left-0 mt-4 w-56 rounded-xl bg-navlight text-black shadow-xl border border-gray-800 overflow-hidden">
          <a href="publications.html" class="block px-5 py-3 hover:bg-gray-100 transition">Publications</a><a href="patents.html" class="block px-5 py-3 hover:bg-gray-100 transition">Patents</a><a href="projects.html" class="block px-5 py-3 hover:bg-gray-100 transition">Projects</a><a href="acknowledgement.html" class="block px-5 py-3 hover:bg-gray-100 transition">Acknowledgements</a><a href="opportunities.html" class="block px-5 py-3 hover:bg-gray-100 transition">Opportunities</a>
        </div>
      </div>
      <div class="flex items-center space-x-3">
        <a href="contacts.html" class="border border-gray-600 p-1 rounded-md"><svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-4 0v7h-4v-7a6 6 0 0 1 6-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a>
        <a href="contacts.html" class="border border-gray-600 p-1 rounded-md"><svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 5.44-1.54 5.44-7A5.44 5.44 0 0 0 19 4.77 5.07 5.07 0 0 0 18.91 1S17.73.65 15 2.48a13.38 13.38 0 0 0-7 0C5.27.65 4.09 1 4.09 1A5.07 5.07 0 0 0 4 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 2.3 6.61 5.44 7A3.37 3.37 0 0 0 7 18.13V22"/></svg></a>
      </div>
      <button id="theme-toggle-desktop" class="cursor-pointer" aria-label="Toggle theme">
        <svg id="sun-icon-desktop" class="w-6 h-6 hidden" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
        <svg id="moon-icon-desktop" class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
      </button>
    </div>
  </nav>
  <nav id="mobile-nav" class="md:hidden fixed top-4 left-4 right-4 z-50 bg-navlight text-black rounded-full py-3 px-5 flex items-center justify-between shadow-lg theme-transition">
    <div class="w-10 h-5 relative overflow-hidden"><a href="index.html"><img id="mobile-logo" src="logo_black.png" alt="AIR Lab Logo" class="w-full h-full object-cover"/></a></div>
    <button type="button" id="mobile-menu-btn" class="mobile-menu-button cursor-pointer p-1" aria-label="Toggle menu"><svg id="menu-icon" class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M3 12h18M3 6h18M3 18h18"/></svg><svg id="close-icon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
  </nav>
  <div id="mobile-menu" class="hidden md:hidden fixed top-20 left-4 right-4 z-40 bg-navlight text-black rounded-2xl py-4 shadow-lg border border-gray-800 theme-transition">
    <div class="flex flex-col space-y-1">
      <a href="teams.html" class="px-5 py-3 hover:bg-gray-100 transition mobile-link">Teams</a><a href="gallery.html" class="px-5 py-3 hover:bg-gray-100 transition mobile-link">Gallery</a><a href="news.html" class="px-5 py-3 hover:bg-gray-100 transition mobile-link">News</a>
      <div><button type="button" id="mobile-research-btn" class="w-full text-left px-5 py-3 flex items-center justify-between hover:bg-gray-100 transition">Research<svg id="mobile-chevron" class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/></svg></button>
        <div id="mobile-research-links" class="hidden pl-4"><a href="publications.html" class="block px-5 py-3 hover:bg-gray-100 transition mobile-link">Publications</a><a href="patents.html" class="block px-5 py-3 hover:bg-gray-100 transition mobile-link">Patents</a><a href="projects.html" class="block px-5 py-3 hover:bg-gray-100 transition mobile-link">Projects</a><a href="acknowledgement.html" class="block px-5 py-3 hover:bg-gray-100 transition mobile-link">Acknowledgements</a><a href="opportunities.html" class="block px-5 py-3 hover:bg-gray-100 transition mobile-link">Opportunities</a></div>
      </div>
      <div class="flex items-center space-x-3 px-5 py-3">
        <a href="contacts.html" class="border border-gray-600 p-1 rounded-md"><svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-4 0v7h-4v-7a6 6 0 0 1 6-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a>
        <a href="contacts.html" class="border border-gray-600 p-1 rounded-md"><svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 5.44-1.54 5.44-7A5.44 5.44 0 0 0 19 4.77 5.07 5.07 0 0 0 18.91 1S17.73.65 15 2.48a13.38 13.38 0 0 0-7 0C5.27.65 4.09 1 4.09 1A5.07 5.07 0 0 0 4 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 2.3 6.61 5.44 7A3.37 3.37 0 0 0 7 18.13V22"/></svg></a>
        <button type="button" id="theme-toggle-mobile" class="border border-gray-600 p-1 rounded-md ml-auto" aria-label="Toggle theme"><svg id="sun-icon-mobile" class="w-5 h-5 hidden" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg><svg id="moon-icon-mobile" class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg></button>
      </div>
    </div>
  </div>

  <!-- MAIN -->
  <div id="page-wrapper" class="min-h-screen bg-black py-12 pt-24 md:py-20 theme-transition">
    <div id="loading-state" class="flex items-center justify-center py-40"><div class="loader border-t-2 rounded-full border-gray-500 bg-gray-300 w-8 h-8"></div></div>
    <div id="error-state" class="hidden flex items-center justify-center py-40"><p class="text-xl text-red-500" id="error-message"></p></div>
    <div id="pub-content" class="hidden max-w-6xl mx-auto px-4 pt-4"></div>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';
    const supabase = createClient('https://yyvndryintsrmkqrdnvb.supabase.co','sb_publishable_e3377RLuiVxmKIMW6-jAKA_Zju9KB5Y');

    let isDarkMode = false;
    let allPubs = [];
    let searchQuery = '';
    let selectedYear = 'all';
    const esc = s => { const d=document.createElement('div'); d.textContent=s||''; return d.innerHTML; };

    // SVGs
    const svg = {
      search: `<svg class="w-5 h-5 opacity-50" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>`,
      chevDown: `<svg class="w-5 h-5 opacity-50 pointer-events-none" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M19 9l-7 7-7-7"/></svg>`,
      calendar: `<svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg>`,
      users: `<svg class="w-4 h-4 opacity-60 mt-1 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></svg>`,
      book: `<svg class="w-4 h-4 opacity-60 mt-1 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>`,
      extLink: `<svg class="w-3 h-3" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6M15 3h6v6M10 14L21 3"/></svg>`,
      award: `<svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="8" r="7"/><path d="M8.21 13.89L7 23l5-3 5 3-1.21-9.12"/></svg>`,
      fileText: `<svg class="w-16 h-16 opacity-30" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/></svg>`,
      bookBig: `<svg class="w-12 h-12 opacity-30 mx-auto mb-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>`,
    };

    function applyTheme() {
      const w=document.getElementById('page-wrapper');
      w.classList.remove('bg-black','bg-white'); w.classList.add(isDarkMode?'bg-white':'bg-black');
      const nc=isDarkMode?{bg:'bg-black',text:'text-white',shadow:'shadow-md',logo:'logo_white.png'}:{bg:'bg-navlight',text:'text-black',shadow:'shadow-lg',logo:'logo_black.png'};
      ['desktop-nav','mobile-nav','mobile-menu'].forEach(id=>{const el=document.getElementById(id);el.classList.remove('bg-navlight','bg-black','text-black','text-white','shadow-lg','shadow-md');el.classList.add(nc.bg,nc.text,nc.shadow);});
      const dd=document.getElementById('desktop-dropdown');dd.classList.remove('bg-navlight','bg-black','text-black','text-white');dd.classList.add(nc.bg,nc.text);
      document.getElementById('desktop-logo').src=nc.logo;document.getElementById('mobile-logo').src=nc.logo;
      document.getElementById('sun-icon-desktop').classList.toggle('hidden',!isDarkMode);document.getElementById('moon-icon-desktop').classList.toggle('hidden',isDarkMode);
      document.getElementById('sun-icon-mobile').classList.toggle('hidden',!isDarkMode);document.getElementById('moon-icon-mobile').classList.toggle('hidden',isDarkMode);
      renderPubs();
    }
    function toggleTheme(){isDarkMode=!isDarkMode;applyTheme();}
    document.getElementById('theme-toggle-desktop').addEventListener('click',toggleTheme);
    document.getElementById('theme-toggle-mobile').addEventListener('click',toggleTheme);

    // Navbar
    const ddBtn=document.getElementById('desktop-dropdown-btn'),ddEl=document.getElementById('desktop-dropdown'),ddC=document.getElementById('desktop-chevron');
    ddBtn.addEventListener('click',()=>{const o=!ddEl.classList.contains('hidden');ddEl.classList.toggle('hidden');ddC.classList.toggle('rotate-180',!o);});
    document.addEventListener('pointerdown',e=>{if(!document.getElementById('desktop-dropdown-wrapper').contains(e.target)){ddEl.classList.add('hidden');ddC.classList.remove('rotate-180');}});
    let mo=false;const mm=document.getElementById('mobile-menu'),mi=document.getElementById('menu-icon'),ci=document.getElementById('close-icon');
    function smm(o){mo=o;mm.classList.toggle('hidden',!o);mi.classList.toggle('hidden',o);ci.classList.toggle('hidden',!o);if(!o){document.getElementById('mobile-research-links').classList.add('hidden');document.getElementById('mobile-chevron').classList.remove('rotate-180');}}
    document.getElementById('mobile-menu-btn').addEventListener('click',()=>smm(!mo));
    document.getElementById('mobile-research-btn').addEventListener('click',()=>{const r=document.getElementById('mobile-research-links'),o=r.classList.contains('hidden');r.classList.toggle('hidden',!o);document.getElementById('mobile-chevron').classList.toggle('rotate-180',o);});
    document.querySelectorAll('.mobile-link').forEach(l=>l.addEventListener('click',()=>smm(false)));
    document.addEventListener('pointerdown',e=>{if(mo&&!mm.contains(e.target)&&!e.target.closest('.mobile-menu-button'))smm(false);});

    function renderPubs() {
      const container = document.getElementById('pub-content');
      const tc = isDarkMode ? 'text-black' : 'text-white';
      const ac = isDarkMode ? 'text-gray-800' : 'text-gray-100';
      const bc = isDarkMode ? 'border-black' : 'border-white/40';
      const bg = isDarkMode ? 'bg-white' : 'bg-black';

      const years = ['all', ...new Set(allPubs.map(p=>p.year))];

      // Filter
      const filtered = allPubs.filter(p => {
        const ms = (p.title||'').toLowerCase().includes(searchQuery.toLowerCase())
          || (p.authors||'').toLowerCase().includes(searchQuery.toLowerCase())
          || (p.journal||'').toLowerCase().includes(searchQuery.toLowerCase());
        const my = selectedYear==='all' || p.year.toString()===selectedYear;
        return ms && my;
      });

      // Group by year
      const grouped = {};
      filtered.forEach(p => { (grouped[p.year] = grouped[p.year] || []).push(p); });

      if (allPubs.length === 0) {
        container.innerHTML = `
          <div class="text-center mb-10 pt-8"><p class="text-xl ${tc} opacity-90 max-w-3xl mx-auto"><span class="text-gold">Research Contributions</span> from AIR Lab in AI, Robotics, and Precision Poultry Farming</p></div>
          <div class="text-center py-16 border ${bc} rounded-xl">
            <div class="relative inline-block mb-6 ${tc}">${svg.fileText}</div>
            <h2 class="text-2xl font-bold ${tc} mb-4">No Publications Yet</h2>
            <p class="text-lg ${tc} px-4 opacity-80 max-w-md mx-auto mb-8">Our publications list is currently under development. Check back soon for research outputs from AIR Lab.</p>
          </div>`;
        return;
      }

      const yearOptions = years.map(y => `<option value="${y}" ${y===selectedYear?'selected':''}>${y==='all'?'All Years':y}</option>`).join('');
      const countInfo = (searchQuery || selectedYear!=='all')
        ? `<div class="mb-8"><p class="text-sm ${tc} opacity-80">Showing ${filtered.length} of ${allPubs.length} publications${selectedYear!=='all'?' from '+selectedYear:''}${searchQuery?' matching "'+esc(searchQuery)+'"':''}</p></div>` : '';

      let listHtml = '';
      if (Object.keys(grouped).length > 0) {
        const sortedYears = Object.keys(grouped).sort((a,b)=>b-a);
        listHtml = '<div class="space-y-12">' + sortedYears.map(year => `
          <div class="pb-8 border-b last:border-b-0 last:pb-0">
            <div class="flex items-center gap-3 mb-8">
              <div class="p-2 border ${bc} rounded-lg ${ac}">${svg.calendar}</div>
              <h2 class="text-3xl font-bold ${tc}">${year}</h2>
            </div>
            <div class="space-y-8">
              ${grouped[year].map(pub => `
                <div class="group border-l-4 ${bc} pl-6 py-2 hover:border-amber-500 transition-colors duration-300">
                  <h3 class="text-xl font-semibold ${tc} mb-3 leading-relaxed">${esc(pub.title)}</h3>
                  <div class="space-y-2 mb-4">
                    <div class="flex items-start gap-2 ${tc}">${svg.users}<p class="text-sm opacity-90">${esc(pub.authors)}</p></div>
                    <div class="flex items-start gap-2 ${tc}">${svg.book}<p class="text-sm italic opacity-80">${esc(pub.journal)}</p></div>
                  </div>
                  ${pub.doi ? `<a href="${pub.doi.startsWith('http')?esc(pub.doi):'https://doi.org/'+esc(pub.doi)}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 text-sm ${ac} hover:underline transition-colors">${svg.extLink} ${esc(pub.doi)}</a>` : ''}
                </div>
              `).join('')}
            </div>
          </div>
        `).join('') + '</div>';
      } else {
        listHtml = `
          <div class="text-center py-16 border ${bc} rounded-xl">
            <div class="${tc}">${svg.bookBig}</div>
            <p class="text-xl ${tc} opacity-70">No publications match your search criteria</p>
            <button id="clear-filters-btn" class="mt-4 px-4 py-2 text-sm border ${bc} rounded-lg ${tc} hover:bg-white hover:text-black transition-all duration-300">Clear filters</button>
          </div>`;
      }

      container.innerHTML = `
        <div class="text-center mb-10 pt-8">
          <p class="text-xl ${tc} opacity-90 max-w-3xl mx-auto"><span class="text-gold">Research Contributions</span> from AIR Lab in AI, Robotics, and Precision Poultry Farming</p>
          <div class="mt-8">
            <a href="https://scholar.google.com/citations?user=6iJnpBMAAAAJ&hl=en&oi=ao" target="_blank" rel="noopener noreferrer"
              class="inline-flex items-center gap-2 px-6 py-3 rounded-full text-sm font-medium border ${bc} ${tc} hover:bg-white hover:text-black transition-all duration-300">
              ${svg.award} View PI's Google Scholar Profile ${svg.extLink}
            </a>
          </div>
        </div>
        <div class="mb-10 flex flex-col md:flex-row gap-4">
          <div class="relative flex-1">
            <div class="absolute left-4 top-1/2 -translate-y-1/2 ${tc}">${svg.search}</div>
            <input type="text" id="search-input" placeholder="Search publications..." value="${esc(searchQuery)}"
              class="w-full pl-12 pr-4 py-3 rounded-xl border ${bc} ${bg} ${tc} focus:outline-none transition-colors"/>
          </div>
          <div class="relative">
            <select id="year-select" class="appearance-none pl-4 pr-10 py-3 rounded-xl border ${bc} ${bg} ${tc} focus:outline-none transition-colors cursor-pointer">${yearOptions}</select>
            <div class="absolute right-3 top-1/2 -translate-y-1/2 ${tc}">${svg.chevDown}</div>
          </div>
        </div>
        ${countInfo}
        ${listHtml}
      `;

      // Bind events
      document.getElementById('search-input').addEventListener('input', e => { searchQuery = e.target.value; renderPubs(); });
      document.getElementById('year-select').addEventListener('change', e => { selectedYear = e.target.value; renderPubs(); });
      const clearBtn = document.getElementById('clear-filters-btn');
      if (clearBtn) clearBtn.addEventListener('click', () => { searchQuery=''; selectedYear='all'; renderPubs(); });
    }

    async function init() {
      try {
        const { data, error } = await supabase.from('publications')
          .select('year,title,authors,journal,doi')
          .order('year',{ascending:false}).order('title',{ascending:true});
        if (error) throw error;
        allPubs = (data||[]).sort((a,b)=>b.year-a.year);
        document.getElementById('loading-state').classList.add('hidden');
        document.getElementById('pub-content').classList.remove('hidden');
        renderPubs();
      } catch(err) {
        document.getElementById('loading-state').classList.add('hidden');
        document.getElementById('error-state').classList.remove('hidden');
        document.getElementById('error-message').textContent = 'Error: '+(err.message||'Failed to fetch publications');
      }
    }
    init(); applyTheme();
  </script>
</body>
</html>
