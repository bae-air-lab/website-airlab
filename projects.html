<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Projects - AIR Lab</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config={theme:{extend:{colors:{gold:'#ba9731',navlight:'#DBE9F4'}}}}</script>
  <style>
    .theme-transition{transition:background-color .3s,color .3s}.dropdown-enter{animation:dropIn .15s ease-out}@keyframes dropIn{from{opacity:0;transform:translateY(-8px)}to{opacity:1;transform:translateY(0)}}.loader{border-top-color:#6b7280;animation:spin 1s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}.line-clamp-2{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
  </style>
</head>
<body class="m-0 p-0">
  <!-- NAVBAR -->
  <nav id="desktop-nav" class="hidden md:flex fixed top-4 left-1/2 -translate-x-1/2 z-50 bg-navlight text-black rounded-full py-3 px-7 items-center space-x-6 shadow-lg theme-transition"><div class="w-12 h-6 relative overflow-hidden flex-shrink-0"><a href="index.html"><img id="desktop-logo" src="logo_black.png" alt="AIR Lab Logo" class="w-full h-full object-cover"/></a></div><div class="flex items-center space-x-8 pl-12"><a href="teams.html" class="hover:text-gray-600 transition">Teams</a><a href="gallery.html" class="hover:text-gray-600 transition">Gallery</a><a href="news.html" class="hover:text-gray-600 transition">News</a><div class="relative" id="desktop-dropdown-wrapper"><button type="button" id="desktop-dropdown-btn" class="flex items-center cursor-pointer gap-1 hover:text-gray-600 transition focus:outline-none">Research<svg id="desktop-chevron" class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/></svg></button><div id="desktop-dropdown" class="hidden dropdown-enter absolute left-0 mt-4 w-56 rounded-xl bg-navlight text-black shadow-xl border border-gray-800 overflow-hidden"><a href="publications.html" class="block px-5 py-3 hover:bg-gray-100 transition">Publications</a><a href="patents.html" class="block px-5 py-3 hover:bg-gray-100 transition">Patents</a><a href="projects.html" class="block px-5 py-3 hover:bg-gray-100 transition">Projects</a><a href="acknowledgement.html" class="block px-5 py-3 hover:bg-gray-100 transition">Acknowledgements</a><a href="opportunities.html" class="block px-5 py-3 hover:bg-gray-100 transition">Opportunities</a></div></div><div class="flex items-center space-x-3"><a href="contacts.html" class="border border-gray-600 p-1 rounded-md"><svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-4 0v7h-4v-7a6 6 0 0 1 6-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a><a href="contacts.html" class="border border-gray-600 p-1 rounded-md"><svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 5.44-1.54 5.44-7A5.44 5.44 0 0 0 19 4.77 5.07 5.07 0 0 0 18.91 1S17.73.65 15 2.48a13.38 13.38 0 0 0-7 0C5.27.65 4.09 1 4.09 1A5.07 5.07 0 0 0 4 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 2.3 6.61 5.44 7A3.37 3.37 0 0 0 7 18.13V22"/></svg></a></div><button id="theme-toggle-desktop" class="cursor-pointer" aria-label="Toggle theme"><svg id="sun-icon-desktop" class="w-6 h-6 hidden" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg><svg id="moon-icon-desktop" class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg></button></div></nav>
  <nav id="mobile-nav" class="md:hidden fixed top-4 left-4 right-4 z-50 bg-navlight text-black rounded-full py-3 px-5 flex items-center justify-between shadow-lg theme-transition"><div class="w-10 h-5 relative overflow-hidden"><a href="index.html"><img id="mobile-logo" src="logo_black.png" alt="AIR Lab Logo" class="w-full h-full object-cover"/></a></div><button type="button" id="mobile-menu-btn" class="mobile-menu-button cursor-pointer p-1" aria-label="Toggle menu"><svg id="menu-icon" class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M3 12h18M3 6h18M3 18h18"/></svg><svg id="close-icon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"/></svg></button></nav>
  <div id="mobile-menu" class="hidden md:hidden fixed top-20 left-4 right-4 z-40 bg-navlight text-black rounded-2xl py-4 shadow-lg border border-gray-800 theme-transition"><div class="flex flex-col space-y-1"><a href="teams.html" class="px-5 py-3 hover:bg-gray-100 transition mobile-link">Teams</a><a href="gallery.html" class="px-5 py-3 hover:bg-gray-100 transition mobile-link">Gallery</a><a href="news.html" class="px-5 py-3 hover:bg-gray-100 transition mobile-link">News</a><div><button type="button" id="mobile-research-btn" class="w-full text-left px-5 py-3 flex items-center justify-between hover:bg-gray-100 transition">Research<svg id="mobile-chevron" class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/></svg></button><div id="mobile-research-links" class="hidden pl-4"><a href="publications.html" class="block px-5 py-3 hover:bg-gray-100 transition mobile-link">Publications</a><a href="patents.html" class="block px-5 py-3 hover:bg-gray-100 transition mobile-link">Patents</a><a href="projects.html" class="block px-5 py-3 hover:bg-gray-100 transition mobile-link">Projects</a><a href="acknowledgement.html" class="block px-5 py-3 hover:bg-gray-100 transition mobile-link">Acknowledgements</a><a href="opportunities.html" class="block px-5 py-3 hover:bg-gray-100 transition mobile-link">Opportunities</a></div></div><div class="flex items-center space-x-3 px-5 py-3"><a href="contacts.html" class="border border-gray-600 p-1 rounded-md"><svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-4 0v7h-4v-7a6 6 0 0 1 6-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a><a href="contacts.html" class="border border-gray-600 p-1 rounded-md"><svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 5.44-1.54 5.44-7A5.44 5.44 0 0 0 19 4.77 5.07 5.07 0 0 0 18.91 1S17.73.65 15 2.48a13.38 13.38 0 0 0-7 0C5.27.65 4.09 1 4.09 1A5.07 5.07 0 0 0 4 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 2.3 6.61 5.44 7A3.37 3.37 0 0 0 7 18.13V22"/></svg></a><button type="button" id="theme-toggle-mobile" class="border border-gray-600 p-1 rounded-md ml-auto" aria-label="Toggle theme"><svg id="sun-icon-mobile" class="w-5 h-5 hidden" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg><svg id="moon-icon-mobile" class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg></button></div></div></div>

  <!-- MAIN -->
  <div id="page-wrapper" class="min-h-screen bg-black py-12 md:py-20 theme-transition">
    <div id="loading-state" class="flex items-center justify-center py-40"><div class="loader border-t-2 rounded-full border-gray-500 bg-gray-300 w-8 h-8"></div></div>
    <div id="error-state" class="hidden flex items-center justify-center text-center py-40"><div class="max-w-md px-6"><p class="text-xl text-red-500 mb-4">Error loading projects</p><p class="text-white opacity-80" id="error-message"></p></div></div>
    <div id="content" class="hidden max-w-6xl mx-auto px-6"></div>
  </div>

  <script type="module">
    import{createClient}from'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';
    const supabase=createClient('https://yyvndryintsrmkqrdnvb.supabase.co','sb_publishable_e3377RLuiVxmKIMW6-jAKA_Zju9KB5Y');
    let isDarkMode=false,allProjects=[],selectedCategory='all',selectedStatus='all';
    const esc=s=>{const d=document.createElement('div');d.textContent=s||'';return d.innerHTML;};
    const ic={
      code:`<svg class="w-16 h-16 opacity-30" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M16 18l6-6-6-6M8 6l-6 6 6 6"/></svg>`,
      codeSm:`<svg class="w-4 h-4 opacity-60" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M16 18l6-6-6-6M8 6l-6 6 6 6"/></svg>`,
      tag:`<svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><circle cx="7" cy="7" r="1"/></svg>`,
      calendar:`<svg class="w-4 h-4 opacity-60" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg>`,
      users:`<svg class="w-4 h-4 opacity-60" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></svg>`,
      camera:`<svg class="w-4 h-4 opacity-60" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>`,
      cameraBig:`<svg class="w-12 h-12 opacity-20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>`,
      imageSm:`<svg class="w-4 h-4 opacity-60" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>`,
      imageBig:`<svg class="w-8 h-8 opacity-20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>`,
      video:`<svg class="w-4 h-4 opacity-60" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2"/></svg>`,
      videoBig:`<svg class="w-8 h-8 opacity-20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2"/></svg>`,
      play:`<svg class="w-5 h-5 opacity-60" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"/></svg>`,
      extLink:`<svg class="w-3 h-3" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6M15 3h6v6M10 14L21 3"/></svg>`,
    };

    // Theme
    function applyTheme(){
      const w=document.getElementById('page-wrapper');w.classList.remove('bg-black','bg-white');w.classList.add(isDarkMode?'bg-white':'bg-black');
      const nc=isDarkMode?{bg:'bg-black',text:'text-white',shadow:'shadow-md',logo:'logo_white.png'}:{bg:'bg-navlight',text:'text-black',shadow:'shadow-lg',logo:'logo_black.png'};
      ['desktop-nav','mobile-nav','mobile-menu'].forEach(id=>{const el=document.getElementById(id);el.classList.remove('bg-navlight','bg-black','text-black','text-white','shadow-lg','shadow-md');el.classList.add(nc.bg,nc.text,nc.shadow);});
      const dd=document.getElementById('desktop-dropdown');dd.classList.remove('bg-navlight','bg-black','text-black','text-white');dd.classList.add(nc.bg,nc.text);
      document.getElementById('desktop-logo').src=nc.logo;document.getElementById('mobile-logo').src=nc.logo;
      document.getElementById('sun-icon-desktop').classList.toggle('hidden',!isDarkMode);document.getElementById('moon-icon-desktop').classList.toggle('hidden',isDarkMode);
      document.getElementById('sun-icon-mobile').classList.toggle('hidden',!isDarkMode);document.getElementById('moon-icon-mobile').classList.toggle('hidden',isDarkMode);
      render();
    }
    function toggleTheme(){isDarkMode=!isDarkMode;applyTheme();}
    document.getElementById('theme-toggle-desktop').addEventListener('click',toggleTheme);
    document.getElementById('theme-toggle-mobile').addEventListener('click',toggleTheme);
    // Navbar
    const ddBtn=document.getElementById('desktop-dropdown-btn'),ddEl=document.getElementById('desktop-dropdown'),ddC=document.getElementById('desktop-chevron');
    ddBtn.addEventListener('click',()=>{const o=!ddEl.classList.contains('hidden');ddEl.classList.toggle('hidden');ddC.classList.toggle('rotate-180',!o);});
    document.addEventListener('pointerdown',e=>{if(!document.getElementById('desktop-dropdown-wrapper').contains(e.target)){ddEl.classList.add('hidden');ddC.classList.remove('rotate-180');}});
    let mo=false;const mm=document.getElementById('mobile-menu'),mi=document.getElementById('menu-icon'),ci=document.getElementById('close-icon');
    function smm(o){mo=o;mm.classList.toggle('hidden',!o);mi.classList.toggle('hidden',o);ci.classList.toggle('hidden',!o);if(!o){document.getElementById('mobile-research-links').classList.add('hidden');document.getElementById('mobile-chevron').classList.remove('rotate-180');}}
    document.getElementById('mobile-menu-btn').addEventListener('click',()=>smm(!mo));
    document.getElementById('mobile-research-btn').addEventListener('click',()=>{const r=document.getElementById('mobile-research-links'),o=r.classList.contains('hidden');r.classList.toggle('hidden',!o);document.getElementById('mobile-chevron').classList.toggle('rotate-180',o);});
    document.querySelectorAll('.mobile-link').forEach(l=>l.addEventListener('click',()=>smm(false)));
    document.addEventListener('pointerdown',e=>{if(mo&&!mm.contains(e.target)&&!e.target.closest('.mobile-menu-button'))smm(false);});

    function render(){
      const c=document.getElementById('content');
      const tc=isDarkMode?'text-black':'text-white',ac=isDarkMode?'text-gray-800':'text-gray-100',bc=isDarkMode?'border-black':'border-white/40',bg=isDarkMode?'bg-white':'bg-black',cardBg=isDarkMode?'bg-gray-100':'bg-gray-800';

      if(!allProjects.length){
        c.innerHTML=`<div class="text-center mb-16 pt-12"><p class="text-xl ${tc} opacity-90 max-w-3xl mx-auto"><span class="text-gold">Research Projects</span> showcasing AIR Lab innovations in AI, Robotics, and autonomy</p></div>
        <div class="text-center py-16 border ${bc} rounded-xl max-w-2xl mx-auto"><div class="relative inline-block mb-6 ${tc}">${ic.code}</div><h2 class="text-2xl font-bold px-4 ${tc} mb-4">No Projects Yet</h2><p class="text-lg ${tc} px-4 opacity-80 max-w-md mx-auto">Our project portfolio is currently being updated. Check back soon for ongoing and completed research initiatives.</p></div>`;
        return;
      }

      const categories=['all',...new Set(allProjects.map(p=>p.category).filter(Boolean))];
      const statuses=['all','active','completed','upcoming'];
      const filtered=allProjects.filter(p=>(selectedCategory==='all'||p.category===selectedCategory)&&(selectedStatus==='all'||p.status===selectedStatus));
      const featured=allProjects.filter(p=>p.featured);

      // Featured banner
      let featuredHtml='';
      if(featured.length){
        featuredHtml=`<div class="mb-12 p-8 border ${bc} rounded-xl">
          <div class="flex items-center gap-2 mb-6"><div class="p-2 border ${bc} rounded-lg ${ac}">${ic.tag}</div><h2 class="text-2xl font-bold ${tc}">Featured Projects</h2></div>
          <div class="grid md:grid-cols-2 gap-8">${featured.map(p=>`
            <div class="group border ${bc} rounded-lg overflow-hidden hover:border-blue-500 transition-colors duration-300">
              ${p.images&&p.images[0]?`<div class="relative h-48 overflow-hidden"><img src="${esc(p.images[0])}" alt="${esc(p.title)}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"/></div>`:`<div class="h-48 ${cardBg} flex items-center justify-center ${tc}">${ic.cameraBig}</div>`}
              <div class="p-6">
                <div class="flex items-center justify-between mb-3"><span class="px-3 py-1 border ${bc} rounded-full text-xs ${tc}">${esc(p.category)}</span><span class="text-sm ${tc} opacity-70">${esc(p.status)}</span></div>
                <h3 class="text-xl font-bold ${tc} mb-2">${esc(p.title)}</h3>
                <p class="text-sm ${tc} opacity-80 mb-4 line-clamp-2">${esc(p.description)}</p>
                <div class="flex items-center gap-4"><div class="flex items-center gap-1 ${tc}">${ic.calendar}<span class="text-xs opacity-70">${esc(p.year)}</span></div><div class="flex items-center gap-1 ${tc}">${ic.users}<span class="text-xs opacity-70">${(p.team||[]).length}</span></div></div>
              </div>
            </div>`).join('')}</div></div>`;
      }

      // Filters
      const catBtns=categories.map(cat=>`<button data-cat="${esc(cat)}" class="filter-cat px-4 py-2 rounded-full text-sm border transition-colors ${selectedCategory===cat?ac+' border-blue-500 bg-blue-500/10':bc+' '+tc+' opacity-80 hover:opacity-100'}">${cat==='all'?'All Categories':esc(cat)}</button>`).join('');
      const statusBtns=statuses.map(s=>`<button data-status="${esc(s)}" class="filter-status px-4 py-2 rounded-full text-sm border transition-colors ${selectedStatus===s?ac+' border-blue-500 bg-blue-500/10':bc+' '+tc+' opacity-80 hover:opacity-100'}">${s==='all'?'All Status':s.charAt(0).toUpperCase()+s.slice(1)}</button>`).join('');

      // Project list
      let listHtml=filtered.map(p=>{
        const techs=(p.technologies||[]).map(t=>`<span class="px-3 py-1 border ${bc} rounded-full text-xs ${tc} opacity-80">${esc(t)}</span>`).join('');
        const team=(p.team||[]).map(m=>`<p class="text-sm ${tc} opacity-80">${esc(m)}</p>`).join('');
        const hasMedia=(p.images&&p.images.length)||(p.videos&&p.videos.length);
        let mediaCount='';
        if(p.images&&p.images.length) mediaCount+=`<div class="flex items-center gap-1 ${tc}">${ic.imageSm}<span class="text-xs opacity-70">${p.images.length} image${p.images.length!==1?'s':''}</span></div>`;
        if(p.videos&&p.videos.length) mediaCount+=`<div class="flex items-center gap-1 ${tc}">${ic.video}<span class="text-xs opacity-70">${p.videos.length} video${p.videos.length!==1?'s':''}</span></div>`;

        let mediaPrev='';
        if(hasMedia){
          const imgs=(p.images||[]).slice(0,3).map((_,i)=>`<div class="relative flex-shrink-0 w-48 h-32 border rounded-lg overflow-hidden border-gray-700"><div class="absolute inset-0 ${cardBg} flex items-center justify-center ${tc}">${ic.imageBig}</div><div class="absolute bottom-2 right-2 px-2 py-1 rounded text-xs ${cardBg} border ${bc} ${tc}">Image</div></div>`).join('');
          const vids=(p.videos||[]).slice(0,2).map((_,i)=>`<div class="relative flex-shrink-0 w-48 h-32 border rounded-lg overflow-hidden border-gray-700"><div class="absolute inset-0 ${cardBg} flex items-center justify-center ${tc}">${ic.videoBig}</div><div class="absolute bottom-2 right-2 px-2 py-1 rounded text-xs ${cardBg} border ${bc} ${tc}">Video</div></div>`).join('');
          mediaPrev=`<div class="mb-8"><div class="flex items-center gap-2 mb-4 ${tc}">${ic.play}<p class="text-sm font-medium">Project Media</p></div><div class="flex gap-4 overflow-x-auto pb-4">${imgs}${vids}</div></div>`;
        }

        const links=(p.links||[]).map(l=>`<a href="${esc(l.url)}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm border ${bc} ${tc} hover:bg-white hover:text-black transition-all duration-300">${ic.extLink} ${esc(l.name)}</a>`).join('');

        return `<div class="group border-l-4 ${bc} pl-6 py-8 hover:border-blue-500 transition-colors duration-300">
          <div class="flex flex-col md:flex-row md:items-start justify-between gap-4 mb-6"><div class="flex-1"><div class="flex items-center gap-3 mb-2"><h3 class="text-2xl font-bold ${tc}">${esc(p.title)}</h3><span class="px-3 py-1 border ${bc} rounded-full text-xs ${tc}">${esc(p.status)}</span></div><p class="text-lg ${ac} mb-3">${esc(p.subtitle||'')}</p><p class="text-base ${tc} opacity-90">${esc(p.description)}</p></div><div class="px-4 py-2 border ${bc} rounded-lg"><span class="text-sm font-medium ${tc}">${esc(p.year)}</span></div></div>
          <div class="grid md:grid-cols-3 gap-6 mb-8"><div><div class="flex items-center gap-2 mb-3 ${tc}">${ic.codeSm}<p class="text-sm font-medium">Technologies</p></div><div class="flex flex-wrap gap-2">${techs}</div></div><div><div class="flex items-center gap-2 mb-3 ${tc}">${ic.users}<p class="text-sm font-medium">Team</p></div><div class="space-y-1">${team}</div></div><div><div class="flex items-center gap-2 mb-3 ${tc}">${ic.camera}<p class="text-sm font-medium">Media</p></div><div class="flex items-center gap-4">${mediaCount}</div></div></div>
          ${mediaPrev}
          ${links?`<div class="flex flex-wrap gap-3">${links}</div>`:''}
        </div>`;
      }).join('');

      if(!filtered.length){
        listHtml=`<div class="mt-12"><div class="text-center py-16 border ${bc} rounded-xl max-w-2xl mx-auto"><div class="${tc}">${ic.code}</div><h3 class="text-2xl font-bold ${tc} mb-4">No Projects Found</h3><p class="text-lg ${tc} opacity-70 mb-8">No projects match your selected filters</p><button id="clear-filters" class="px-6 py-3 rounded-full text-sm font-medium border ${bc} ${tc} hover:bg-white hover:text-black transition-all duration-300">Clear filters</button></div></div>`;
      }

      c.innerHTML=`
        <div class="text-center mb-16 pt-12"><p class="text-xl ${tc} opacity-90 max-w-3xl mx-auto"><span class="text-gold">Research Projects</span> showcasing AIR Lab innovations in AI, Robotics, and autonomy</p></div>
        ${featuredHtml}
        <div class="mb-10"><div class="flex flex-col md:flex-row gap-4 mb-8"><div class="flex-1"><label class="block text-sm font-medium ${tc} opacity-80 mb-2">Filter by Category</label><div class="flex flex-wrap gap-2">${catBtns}</div></div><div><label class="block text-sm font-medium ${tc} opacity-80 mb-2">Filter by Status</label><div class="flex flex-wrap gap-2">${statusBtns}</div></div></div><p class="text-sm ${tc} opacity-70">Showing ${filtered.length} of ${allProjects.length} projects</p></div>
        <div class="space-y-12">${listHtml}</div>
        <div class="mt-16 pt-12 border-t ${bc} text-center"><p class="text-sm ${tc} opacity-70">Ongoing research projects at AIR Lab, NC State University</p></div>`;

      // Bind filter buttons
      c.querySelectorAll('.filter-cat').forEach(b=>b.addEventListener('click',()=>{selectedCategory=b.dataset.cat;render();}));
      c.querySelectorAll('.filter-status').forEach(b=>b.addEventListener('click',()=>{selectedStatus=b.dataset.status;render();}));
      const clr=document.getElementById('clear-filters');
      if(clr)clr.addEventListener('click',()=>{selectedCategory='all';selectedStatus='all';render();});
    }

    async function init(){
      try{
        const{data,error}=await supabase.from('projects').select('id,title,subtitle,description,year,status,category,technologies,team,featured,images,videos,links').order('featured',{ascending:false}).order('id',{ascending:true});
        if(error)throw error;
        allProjects=(data||[]).map(p=>({...p,technologies:p.technologies||[],team:p.team||[],images:p.images||[],videos:p.videos||[],links:Array.isArray(p.links)?p.links:[]}));
        document.getElementById('loading-state').classList.add('hidden');
        document.getElementById('content').classList.remove('hidden');
        render();
      }catch(err){
        document.getElementById('loading-state').classList.add('hidden');
        document.getElementById('error-state').classList.remove('hidden');
        document.getElementById('error-message').textContent=err.message||'Failed to load projects';
      }
    }
    init();applyTheme();
  </script>
</body>
</html>
