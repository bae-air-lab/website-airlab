<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AIR Lab — Intelligence and Robotics</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            gold: '#ba9731',
            navlight: '#DBE9F4',
          }
        }
      }
    }
  </script>
  <style>
    /* Smooth theme transitions */
    .theme-transition { transition: background-color 0.3s, color 0.3s; }
    /* Dropdown animation */
    .dropdown-enter { animation: dropIn 0.15s ease-out; }
    @keyframes dropIn {
      from { opacity: 0; transform: translateY(-8px); }
      to { opacity: 1; transform: translateY(0); }
    }
    /* WebGL canvas fills container */
    #threads-container canvas {
      display: block;
      width: 100% !important;
      height: 100% !important;
    }
  </style>
</head>

<body class="m-0 p-0 overflow-hidden">

  <!-- ==================== DESKTOP NAVBAR ==================== -->
  <nav id="desktop-nav"
    class="hidden md:flex fixed top-4 left-1/2 -translate-x-1/2 z-50
           bg-navlight text-black rounded-full py-3 px-7
           items-center space-x-6 shadow-lg theme-transition">

    <!-- Logo -->
    <div class="w-12 h-6 relative overflow-hidden flex-shrink-0">
      <a href="index.html">
        <img id="desktop-logo" src="logo_black.png" alt="AIR Lab Logo"
             class="w-full h-full object-cover" />
      </a>
    </div>

    <!-- Nav Links -->
    <div class="flex items-center space-x-8 pl-12">
      <a href="teams.html" class="hover:text-gray-600 transition">Teams</a>
      <a href="gallery.html" class="hover:text-gray-600 transition">Gallery</a>
      <a href="news.html" class="hover:text-gray-600 transition">News</a>

      <!-- Research Dropdown -->
      <div class="relative" id="desktop-dropdown-wrapper">
        <button type="button" id="desktop-dropdown-btn"
          class="flex items-center cursor-pointer gap-1 hover:text-gray-600 transition focus:outline-none">
          Research
          <svg id="desktop-chevron" class="w-4 h-4 transition-transform" fill="none"
               stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
          </svg>
        </button>

        <div id="desktop-dropdown" class="hidden dropdown-enter absolute left-0 mt-4 w-56 rounded-xl
             bg-navlight text-black shadow-xl border border-gray-800 overflow-hidden">
          <a href="publications.html" class="block px-5 py-3 hover:bg-gray-100 transition">Publications</a>
          <a href="patents.html" class="block px-5 py-3 hover:bg-gray-100 transition">Patents</a>
          <a href="projects.html" class="block px-5 py-3 hover:bg-gray-100 transition">Projects</a>
          <a href="acknowledgement.html" class="block px-5 py-3 hover:bg-gray-100 transition">Acknowledgements</a>
          <a href="opportunities.html" class="block px-5 py-3 hover:bg-gray-100 transition">Opportunities</a>
        </div>
      </div>

      <!-- Social Icons -->
      <div class="flex items-center space-x-3">
        <a href="contacts.html" class="border border-gray-600 p-1 rounded-md">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-4 0v7h-4v-7a6 6 0 0 1 6-6z"/>
            <rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/>
          </svg>
        </a>
        <a href="contacts.html" class="border border-gray-600 p-1 rounded-md">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35
                     5.44-1.54 5.44-7A5.44 5.44 0 0 0 19 4.77 5.07 5.07 0 0 0 18.91
                     1S17.73.65 15 2.48a13.38 13.38 0 0 0-7 0C5.27.65 4.09 1 4.09
                     1A5.07 5.07 0 0 0 4 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 2.3
                     6.61 5.44 7A3.37 3.37 0 0 0 7 18.13V22"/>
          </svg>
        </a>
      </div>

      <!-- Theme Toggle -->
      <button id="theme-toggle-desktop" class="cursor-pointer" aria-label="Toggle theme">
        <!-- Sun icon (shown in light mode / isDarkMode=true in original, but let's match: light mode default) -->
        <svg id="sun-icon-desktop" class="w-6 h-6 hidden" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36
          18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
        </svg>
        <!-- Moon icon -->
        <svg id="moon-icon-desktop" class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
        </svg>
      </button>
    </div>
  </nav>

  <!-- ==================== MOBILE NAVBAR ==================== -->
  <nav id="mobile-nav"
    class="md:hidden fixed top-4 left-4 right-4 z-50
           bg-navlight text-black rounded-full py-3 px-5
           flex items-center justify-between shadow-lg theme-transition">
    <div class="w-10 h-5 relative overflow-hidden">
      <a href="index.html">
        <img id="mobile-logo" src="logo_black.png" alt="AIR Lab Logo"
             class="w-full h-full object-cover" />
      </a>
    </div>
    <button type="button" id="mobile-menu-btn" class="mobile-menu-button cursor-pointer p-1" aria-label="Toggle menu">
      <!-- Hamburger -->
      <svg id="menu-icon" class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <path d="M3 12h18M3 6h18M3 18h18"/>
      </svg>
      <!-- X -->
      <svg id="close-icon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <path d="M18 6L6 18M6 6l12 12"/>
      </svg>
    </button>
  </nav>

  <!-- Mobile Menu Panel -->
  <div id="mobile-menu"
    class="hidden md:hidden fixed top-20 left-4 right-4 z-40
           bg-navlight text-black rounded-2xl py-4 shadow-lg border border-gray-800 theme-transition">
    <div class="flex flex-col space-y-1">
      <a href="teams.html" class="px-5 py-3 hover:bg-gray-100 transition mobile-link">Teams</a>
      <a href="gallery.html" class="px-5 py-3 hover:bg-gray-100 transition mobile-link">Gallery</a>
      <a href="news.html" class="px-5 py-3 hover:bg-gray-100 transition mobile-link">News</a>

      <!-- Research Submenu -->
      <div>
        <button type="button" id="mobile-research-btn"
          class="w-full text-left px-5 py-3 flex items-center justify-between hover:bg-gray-100 transition">
          Research
          <svg id="mobile-chevron" class="w-4 h-4 transition-transform" fill="none"
               stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
          </svg>
        </button>
        <div id="mobile-research-links" class="hidden pl-4">
          <a href="publications.html" class="block px-5 py-3 hover:bg-gray-100 transition mobile-link">Publications</a>
          <a href="patents.html" class="block px-5 py-3 hover:bg-gray-100 transition mobile-link">Patents</a>
          <a href="projects.html" class="block px-5 py-3 hover:bg-gray-100 transition mobile-link">Projects</a>
          <a href="acknowledgement.html" class="block px-5 py-3 hover:bg-gray-100 transition mobile-link">Acknowledgements</a>
          <a href="opportunities.html" class="block px-5 py-3 hover:bg-gray-100 transition mobile-link">Opportunities</a>
        </div>
      </div>

      <!-- Social + Theme -->
      <div class="flex items-center space-x-3 px-5 py-3">
        <a href="contacts.html" class="border border-gray-600 p-1 rounded-md">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-4 0v7h-4v-7a6 6 0 0 1 6-6z"/>
            <rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/>
          </svg>
        </a>
        <a href="contacts.html" class="border border-gray-600 p-1 rounded-md">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35
                     5.44-1.54 5.44-7A5.44 5.44 0 0 0 19 4.77 5.07 5.07 0 0 0 18.91
                     1S17.73.65 15 2.48a13.38 13.38 0 0 0-7 0C5.27.65 4.09 1 4.09
                     1A5.07 5.07 0 0 0 4 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 2.3
                     6.61 5.44 7A3.37 3.37 0 0 0 7 18.13V22"/>
          </svg>
        </a>
        <button type="button" id="theme-toggle-mobile"
          class="border border-gray-600 p-1 rounded-md ml-auto" aria-label="Toggle theme">
          <svg id="sun-icon-mobile" class="w-5 h-5 hidden" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36
            18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
          </svg>
          <svg id="moon-icon-mobile" class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- ==================== MAIN PAGE ==================== -->
  <div id="page-wrapper" class="relative w-full h-screen bg-black overflow-hidden theme-transition">

    <!-- Threads WebGL Canvas -->
    <div id="threads-container" class="absolute top-0 left-0 w-full h-full z-0"></div>

    <!-- Hero Content -->
    <div class="absolute inset-0 flex flex-col justify-center items-center z-10 text-center px-6 space-y-12 mt-12">
      <h1 class="text-5xl md:text-6xl font-extrabold text-white leading-tight" id="hero-heading">
        Pioneering the Future of <br class="hidden md:block" />
        <span class="text-gold">Intelligence and Robotics</span>
      </h1>

      <div class="flex flex-col justify-center items-center space-y-8">
        <p class="text-lg md:text-xl text-white opacity-80 max-w-2xl" id="hero-sub1">
          <span class="font-semibold">AIR Lab</span> for shaping
          tomorrow's intelligent world through research and innovation.
        </p>
        <p class="text-lg md:text-xl text-white opacity-80 max-w-2xl" id="hero-sub2">
          Department of Biological and Agricultural Engineering College of
          Agriculture and Life Sciences, North Carolina State University
        </p>
      </div>

      <!-- CTA Buttons -->
      <div class="flex flex-wrap justify-center gap-12">
        <a id="cta-explore" href="projects.html"
          class="px-6 py-3 bg-gold hover:bg-navlight text-white hover:text-black rounded-lg font-medium transition-all duration-300">
          Explore Research
        </a>
        <a id="cta-team" href="teams.html"
          class="px-6 py-3 font-semibold border border-white/40 border-black text-white hover:bg-white hover:text-black rounded-lg font-medium transition-all duration-300">
          Meet Our Team
        </a>
      </div>
    </div>

    <!-- Gradient Overlay -->
    <div class="absolute inset-0 bg-gradient-to-t from-black/40 via-transparent to-transparent z-[5]"></div>
  </div>

  <!-- ==================== OGL LIBRARY (Threads WebGL) ==================== -->
  <script type="module">
    import { Renderer, Program, Mesh, Triangle, Color } from 'https://cdn.jsdelivr.net/npm/ogl@1.0.8/+esm';

    // ── Shader sources ──
    const vertexShader = `
      attribute vec2 position;
      attribute vec2 uv;
      varying vec2 vUv;
      void main() {
        vUv = uv;
        gl_Position = vec4(position, 0.0, 1.0);
      }
    `;

    const fragmentShader = `
      precision highp float;
      uniform float iTime;
      uniform vec3 iResolution;
      uniform vec3 uColor;
      uniform float uAmplitude;
      uniform float uDistance;
      uniform vec2 uMouse;
      #define PI 3.1415926538
      const int u_line_count = 40;
      const float u_line_width = 7.0;
      const float u_line_blur = 10.0;

      float Perlin2D(vec2 P) {
        vec2 Pi = floor(P);
        vec4 Pf_Pfmin1 = P.xyxy - vec4(Pi, Pi + 1.0);
        vec4 Pt = vec4(Pi.xy, Pi.xy + 1.0);
        Pt = Pt - floor(Pt * (1.0 / 71.0)) * 71.0;
        Pt += vec2(26.0, 161.0).xyxy;
        Pt *= Pt;
        Pt = Pt.xzxz * Pt.yyww;
        vec4 hash_x = fract(Pt * (1.0 / 951.135664));
        vec4 hash_y = fract(Pt * (1.0 / 642.949883));
        vec4 grad_x = hash_x - 0.49999;
        vec4 grad_y = hash_y - 0.49999;
        vec4 grad_results = inversesqrt(grad_x * grad_x + grad_y * grad_y)
            * (grad_x * Pf_Pfmin1.xzxz + grad_y * Pf_Pfmin1.yyww);
        grad_results *= 1.4142135623730950;
        vec2 blend = Pf_Pfmin1.xy * Pf_Pfmin1.xy * Pf_Pfmin1.xy
                   * (Pf_Pfmin1.xy * (Pf_Pfmin1.xy * 6.0 - 15.0) + 10.0);
        vec4 blend2 = vec4(blend, vec2(1.0 - blend));
        return dot(grad_results, blend2.zxzx * blend2.wwyy);
      }

      float pixel(float count, vec2 resolution) {
        return (1.0 / max(resolution.x, resolution.y)) * count;
      }

      float lineFn(vec2 st, float width, float perc, float offset, vec2 mouse,
                    float time, float amplitude, float distance) {
        float split_offset = (perc * 0.4);
        float split_point = 0.1 + split_offset;
        float amplitude_normal = smoothstep(split_point, 0.7, st.x);
        float amplitude_strength = 0.5;
        float finalAmplitude = amplitude_normal * amplitude_strength
                               * amplitude * (1.0 + (mouse.y - 0.5) * 0.2);
        float time_scaled = time / 10.0 + (mouse.x - 0.5) * 1.0;
        float blur = smoothstep(split_point, split_point + 0.05, st.x) * perc;
        float xnoise = mix(
            Perlin2D(vec2(time_scaled, st.x + perc) * 2.5),
            Perlin2D(vec2(time_scaled, st.x + time_scaled) * 3.5) / 1.5,
            st.x * 0.3
        );
        float y = 0.5 + (perc - 0.5) * distance + xnoise / 2.0 * finalAmplitude;
        float line_start = smoothstep(
            y + (width / 2.0) + (u_line_blur * pixel(1.0, iResolution.xy) * blur), y, st.y
        );
        float line_end = smoothstep(
            y, y - (width / 2.0) - (u_line_blur * pixel(1.0, iResolution.xy) * blur), st.y
        );
        return clamp((line_start - line_end) * (1.0 - smoothstep(0.0, 1.0, pow(perc, 0.3))), 0.0, 1.0);
      }

      void mainImage(out vec4 fragColor, in vec2 fragCoord) {
        vec2 uv = fragCoord / iResolution.xy;
        float line_strength = 1.0;
        for (int i = 0; i < u_line_count; i++) {
            float p = float(i) / float(u_line_count);
            line_strength *= (1.0 - lineFn(uv,
                u_line_width * pixel(1.0, iResolution.xy) * (1.0 - p),
                p, (PI * 1.0) * p, uMouse, iTime, uAmplitude, uDistance));
        }
        float colorVal = 1.0 - line_strength;
        fragColor = vec4(uColor * colorVal, colorVal);
      }

      void main() { mainImage(gl_FragColor, gl_FragCoord.xy); }
    `;

    // ── Theme state ──
    let isDarkMode = false; // false = "light" in your color_mode (black bg, white threads)

    const themes = {
      light: {
        bgClass: 'bg-black', textClass: 'text-white',
        navBgClass: 'bg-navlight', navTextClass: 'text-black',
        threadsColor: [1, 1, 1],
        heroTextClass: 'text-white',
        borderClass: 'border-white/40',
        ctaBorderClass: 'border-white/40 border-black',
        logo: 'logo_black.png',
        hoverBg: 'hover:bg-gray-100',
        dropdownBg: 'hover:bg-gray-100',
      },
      dark: {
        bgClass: 'bg-white', textClass: 'text-black',
        navBgClass: 'bg-black', navTextClass: 'text-white',
        threadsColor: [0, 0, 0],
        heroTextClass: 'text-black',
        borderClass: 'border-black',
        ctaBorderClass: 'border-black',
        logo: 'logo_white.png',
        hoverBg: 'hover:bg-gray-200',
        dropdownBg: 'bg-white',
      }
    };

    function currentTheme() { return isDarkMode ? themes.dark : themes.light; }

    // ── Init Threads WebGL ──
    const container = document.getElementById('threads-container');
    const renderer = new Renderer({ alpha: true });
    const gl = renderer.gl;
    gl.clearColor(0, 0, 0, 0);
    gl.enable(gl.BLEND);
    gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);
    container.appendChild(gl.canvas);

    const geometry = new Triangle(gl);
    const program = new Program(gl, {
      vertex: vertexShader,
      fragment: fragmentShader,
      uniforms: {
        iTime: { value: 0 },
        iResolution: { value: new Color(gl.canvas.width, gl.canvas.height, gl.canvas.width / gl.canvas.height) },
        uColor: { value: new Color(1, 1, 1) },
        uAmplitude: { value: 1 },
        uDistance: { value: 0 },
        uMouse: { value: new Float32Array([0.5, 0.5]) },
      },
    });
    const mesh = new Mesh(gl, { geometry, program });

    function resizeGL() {
      const w = container.clientWidth, h = container.clientHeight;
      renderer.setSize(w, h);
      program.uniforms.iResolution.value.r = w;
      program.uniforms.iResolution.value.g = h;
      program.uniforms.iResolution.value.b = w / h;
    }
    window.addEventListener('resize', resizeGL);
    resizeGL();

    // Mouse interaction
    let currentMouse = [0.5, 0.5], targetMouse = [0.5, 0.5];
    container.addEventListener('mousemove', (e) => {
      const rect = container.getBoundingClientRect();
      targetMouse = [(e.clientX - rect.left) / rect.width, 1 - (e.clientY - rect.top) / rect.height];
    });
    container.addEventListener('mouseleave', () => { targetMouse = [0.5, 0.5]; });

    function animate(t) {
      currentMouse[0] += 0.05 * (targetMouse[0] - currentMouse[0]);
      currentMouse[1] += 0.05 * (targetMouse[1] - currentMouse[1]);
      program.uniforms.uMouse.value[0] = currentMouse[0];
      program.uniforms.uMouse.value[1] = currentMouse[1];
      program.uniforms.iTime.value = t * 0.001;
      renderer.render({ scene: mesh });
      requestAnimationFrame(animate);
    }
    requestAnimationFrame(animate);

    // ── Theme toggle logic ──
    function applyTheme() {
      const t = currentTheme();
      const wrapper = document.getElementById('page-wrapper');

      // Background
      wrapper.classList.remove('bg-black', 'bg-white');
      wrapper.classList.add(t.bgClass);

      // Hero text
      document.getElementById('hero-heading').classList.remove('text-white', 'text-black');
      document.getElementById('hero-heading').classList.add(t.heroTextClass);
      ['hero-sub1', 'hero-sub2'].forEach(id => {
        const el = document.getElementById(id);
        el.classList.remove('text-white', 'text-black');
        el.classList.add(t.heroTextClass);
      });

      // CTA team button border
      const ctaTeam = document.getElementById('cta-team');
      ctaTeam.classList.remove('border-white/40', 'border-black', 'text-white', 'text-black');
      ctaTeam.className = ctaTeam.className; // force reflow
      if (isDarkMode) {
        ctaTeam.classList.add('border-black', 'text-black');
      } else {
        ctaTeam.classList.add('border-white/40', 'border-black', 'text-white');
      }

      // CTA explore button
      const ctaExplore = document.getElementById('cta-explore');
      if (isDarkMode) {
        ctaExplore.classList.remove('hover:bg-navlight', 'hover:text-black');
        ctaExplore.classList.add('hover:bg-gold');
      } else {
        ctaExplore.classList.remove('hover:bg-gold');
        ctaExplore.classList.add('hover:bg-navlight', 'hover:text-black');
      }

      // Desktop navbar
      const desktopNav = document.getElementById('desktop-nav');
      desktopNav.classList.remove('bg-navlight', 'bg-black', 'text-black', 'text-white', 'shadow-lg', 'shadow-md');
      desktopNav.classList.add(t.navBgClass, t.navTextClass, isDarkMode ? 'shadow-md' : 'shadow-lg');

      // Desktop dropdown
      const dd = document.getElementById('desktop-dropdown');
      dd.classList.remove('bg-navlight', 'bg-black', 'text-black', 'text-white');
      dd.classList.add(t.navBgClass, t.navTextClass);

      // Mobile navbar + menu
      const mobileNav = document.getElementById('mobile-nav');
      mobileNav.classList.remove('bg-navlight', 'bg-black', 'text-black', 'text-white', 'shadow-lg', 'shadow-md');
      mobileNav.classList.add(t.navBgClass, t.navTextClass, isDarkMode ? 'shadow-md' : 'shadow-lg');

      const mobileMenu = document.getElementById('mobile-menu');
      mobileMenu.classList.remove('bg-navlight', 'bg-black', 'text-black', 'text-white', 'shadow-lg', 'shadow-md');
      mobileMenu.classList.add(t.navBgClass, t.navTextClass, isDarkMode ? 'shadow-md' : 'shadow-lg');

      // Logos
      document.getElementById('desktop-logo').src = t.logo;
      document.getElementById('mobile-logo').src = t.logo;

      // Theme toggle icons
      const showSun = isDarkMode;
      document.getElementById('sun-icon-desktop').classList.toggle('hidden', !showSun);
      document.getElementById('moon-icon-desktop').classList.toggle('hidden', showSun);
      document.getElementById('sun-icon-mobile').classList.toggle('hidden', !showSun);
      document.getElementById('moon-icon-mobile').classList.toggle('hidden', showSun);

      // WebGL thread color
      program.uniforms.uColor.value.r = t.threadsColor[0];
      program.uniforms.uColor.value.g = t.threadsColor[1];
      program.uniforms.uColor.value.b = t.threadsColor[2];
    }

    function toggleTheme() {
      isDarkMode = !isDarkMode;
      applyTheme();
    }

    document.getElementById('theme-toggle-desktop').addEventListener('click', toggleTheme);
    document.getElementById('theme-toggle-mobile').addEventListener('click', toggleTheme);

    // ── Desktop dropdown ──
    const ddBtn = document.getElementById('desktop-dropdown-btn');
    const dd = document.getElementById('desktop-dropdown');
    const ddChevron = document.getElementById('desktop-chevron');

    ddBtn.addEventListener('click', () => {
      const isOpen = !dd.classList.contains('hidden');
      dd.classList.toggle('hidden');
      ddChevron.classList.toggle('rotate-180', !isOpen);
    });

    document.addEventListener('pointerdown', (e) => {
      const wrapper = document.getElementById('desktop-dropdown-wrapper');
      if (wrapper && !wrapper.contains(e.target)) {
        dd.classList.add('hidden');
        ddChevron.classList.remove('rotate-180');
      }
    });

    // ── Mobile menu ──
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    const menuIcon = document.getElementById('menu-icon');
    const closeIcon = document.getElementById('close-icon');
    const mobileResearchBtn = document.getElementById('mobile-research-btn');
    const mobileResearchLinks = document.getElementById('mobile-research-links');
    const mobileChevron = document.getElementById('mobile-chevron');

    let mobileOpen = false;
    let mobileResearchOpen = false;

    function setMobileMenu(open) {
      mobileOpen = open;
      mobileMenu.classList.toggle('hidden', !open);
      menuIcon.classList.toggle('hidden', open);
      closeIcon.classList.toggle('hidden', !open);
      if (!open) {
        mobileResearchOpen = false;
        mobileResearchLinks.classList.add('hidden');
        mobileChevron.classList.remove('rotate-180');
      }
    }

    mobileMenuBtn.addEventListener('click', () => setMobileMenu(!mobileOpen));

    mobileResearchBtn.addEventListener('click', () => {
      mobileResearchOpen = !mobileResearchOpen;
      mobileResearchLinks.classList.toggle('hidden', !mobileResearchOpen);
      mobileChevron.classList.toggle('rotate-180', mobileResearchOpen);
    });

    // Close mobile menu on link click
    document.querySelectorAll('.mobile-link').forEach(link => {
      link.addEventListener('click', () => setMobileMenu(false));
    });

    // Close mobile menu on outside click
    document.addEventListener('pointerdown', (e) => {
      if (mobileOpen && !mobileMenu.contains(e.target) && !e.target.closest('.mobile-menu-button')) {
        setMobileMenu(false);
      }
    });

    // Initial theme
    applyTheme();
  </script>

</body>
</html>
