<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Team Member - AIR Lab</title>
  <script src="https://cdn.tailwindcss.com"></script> 
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: { extend: { colors: { gold: '#ba9731', navlight: '#DBE9F4' } } }
    }
  </script>
  <style>
    .theme-transition { transition: background-color 0.3s, color 0.3s; }
    .dropdown-enter { animation: dropIn 0.15s ease-out; }
    @keyframes dropIn { from { opacity:0; transform:translateY(-8px); } to { opacity:1; transform:translateY(0); } }
    .loader { border-top-color: #6b7280; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body class="m-0 p-0">

  <!-- ==================== DESKTOP NAVBAR ==================== -->
  <nav id="desktop-nav"
    class="hidden md:flex fixed top-4 left-1/2 -translate-x-1/2 z-50
           bg-navlight text-black rounded-full py-3 px-7
           items-center space-x-6 shadow-lg theme-transition">
    <div class="w-12 h-6 relative overflow-hidden flex-shrink-0">
      <a href="index.html"><img id="desktop-logo" src="logo_black.png" alt="AIR Lab Logo" class="w-full h-full object-cover" /></a>
    </div>
    <div class="flex items-center space-x-8 pl-12">
      <a href="teams.html" class="hover:text-gray-600 transition">Teams</a>
      <a href="gallery.html" class="hover:text-gray-600 transition">Gallery</a>
      <a href="news.html" class="hover:text-gray-600 transition">News</a>
      <div class="relative" id="desktop-dropdown-wrapper">
        <button type="button" id="desktop-dropdown-btn" class="flex items-center cursor-pointer gap-1 hover:text-gray-600 transition focus:outline-none">
          Research
          <svg id="desktop-chevron" class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/></svg>
        </button>
        <div id="desktop-dropdown" class="hidden dropdown-enter absolute left-0 mt-4 w-56 rounded-xl bg-navlight text-black shadow-xl border border-gray-800 overflow-hidden">
          <a href="publications.html" class="block px-5 py-3 hover:bg-gray-100 transition">Publications</a>
          <a href="patents.html" class="block px-5 py-3 hover:bg-gray-100 transition">Patents</a>
          <a href="projects.html" class="block px-5 py-3 hover:bg-gray-100 transition">Projects</a>
          <a href="acknowledgement.html" class="block px-5 py-3 hover:bg-gray-100 transition">Acknowledgements</a>
          <a href="opportunities.html" class="block px-5 py-3 hover:bg-gray-100 transition">Opportunities</a>
        </div>
      </div>
      <div class="flex items-center space-x-3">
        <a href="contacts.html" class="border border-gray-600 p-1 rounded-md">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-4 0v7h-4v-7a6 6 0 0 1 6-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg>
        </a>
        <a href="contacts.html" class="border border-gray-600 p-1 rounded-md">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 5.44-1.54 5.44-7A5.44 5.44 0 0 0 19 4.77 5.07 5.07 0 0 0 18.91 1S17.73.65 15 2.48a13.38 13.38 0 0 0-7 0C5.27.65 4.09 1 4.09 1A5.07 5.07 0 0 0 4 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 2.3 6.61 5.44 7A3.37 3.37 0 0 0 7 18.13V22"/></svg>
        </a>
      </div>
      <button id="theme-toggle-desktop" class="cursor-pointer" aria-label="Toggle theme">
        <svg id="sun-icon-desktop" class="w-6 h-6 hidden" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
        <svg id="moon-icon-desktop" class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
      </button>
    </div>
  </nav>

  <!-- ==================== MOBILE NAVBAR ==================== -->
  <nav id="mobile-nav"
    class="md:hidden fixed top-4 left-4 right-4 z-50
           bg-navlight text-black rounded-full py-3 px-5
           flex items-center justify-between shadow-lg theme-transition">
    <div class="w-10 h-5 relative overflow-hidden">
      <a href="index.html"><img id="mobile-logo" src="logo_black.png" alt="AIR Lab Logo" class="w-full h-full object-cover" /></a>
    </div>
    <button type="button" id="mobile-menu-btn" class="mobile-menu-button cursor-pointer p-1" aria-label="Toggle menu">
      <svg id="menu-icon" class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M3 12h18M3 6h18M3 18h18"/></svg>
      <svg id="close-icon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"/></svg>
    </button>
  </nav>
  <div id="mobile-menu" class="hidden md:hidden fixed top-20 left-4 right-4 z-40 bg-navlight text-black rounded-2xl py-4 shadow-lg border border-gray-800 theme-transition">
    <div class="flex flex-col space-y-1">
      <a href="teams.html" class="px-5 py-3 hover:bg-gray-100 transition mobile-link">Teams</a>
      <a href="gallery.html" class="px-5 py-3 hover:bg-gray-100 transition mobile-link">Gallery</a>
      <a href="news.html" class="px-5 py-3 hover:bg-gray-100 transition mobile-link">News</a>
      <div>
        <button type="button" id="mobile-research-btn" class="w-full text-left px-5 py-3 flex items-center justify-between hover:bg-gray-100 transition">
          Research <svg id="mobile-chevron" class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/></svg>
        </button>
        <div id="mobile-research-links" class="hidden pl-4">
          <a href="publications.html" class="block px-5 py-3 hover:bg-gray-100 transition mobile-link">Publications</a>
          <a href="patents.html" class="block px-5 py-3 hover:bg-gray-100 transition mobile-link">Patents</a>
          <a href="projects.html" class="block px-5 py-3 hover:bg-gray-100 transition mobile-link">Projects</a>
          <a href="acknowledgement.html" class="block px-5 py-3 hover:bg-gray-100 transition mobile-link">Acknowledgements</a>
          <a href="opportunities.html" class="block px-5 py-3 hover:bg-gray-100 transition mobile-link">Opportunities</a>
        </div>
      </div>
      <div class="flex items-center space-x-3 px-5 py-3">
        <a href="contacts.html" class="border border-gray-600 p-1 rounded-md"><svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-4 0v7h-4v-7a6 6 0 0 1 6-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a>
        <a href="contacts.html" class="border border-gray-600 p-1 rounded-md"><svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 5.44-1.54 5.44-7A5.44 5.44 0 0 0 19 4.77 5.07 5.07 0 0 0 18.91 1S17.73.65 15 2.48a13.38 13.38 0 0 0-7 0C5.27.65 4.09 1 4.09 1A5.07 5.07 0 0 0 4 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 2.3 6.61 5.44 7A3.37 3.37 0 0 0 7 18.13V22"/></svg></a>
        <button type="button" id="theme-toggle-mobile" class="border border-gray-600 p-1 rounded-md ml-auto" aria-label="Toggle theme">
          <svg id="sun-icon-mobile" class="w-5 h-5 hidden" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
          <svg id="moon-icon-mobile" class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
        </button>
      </div>
    </div>
  </div>

  <!-- ==================== PAGE CONTENT ==================== -->
  <div id="page-wrapper" class="min-h-screen bg-gray-50 py-12 md:py-20 theme-transition">

    <!-- Loading -->
    <div id="loading-state" class="flex items-center justify-center py-40">
      <div class="loader border-t-2 rounded-full border-gray-500 bg-gray-300 w-8 h-8"></div>
    </div>

    <!-- Error / Not Found -->
    <div id="error-state" class="hidden flex flex-col items-center justify-center py-40 space-y-4">
      <p class="text-xl text-red-500" id="error-message">Member not found</p>
      <a href="teams.html" class="text-sm text-gray-500 hover:text-black transition">← Back to Team</a>
    </div>

    <!-- Profile Content -->
    <div id="profile-content" class="hidden max-w-6xl mx-auto px-6 pt-12"></div>
  </div>

  <!-- ==================== SUPABASE + LOGIC ==================== -->
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

    const supabase = createClient(
      'https://yyvndryintsrmkqrdnvb.supabase.co',
      'sb_publishable_e3377RLuiVxmKIMW6-jAKA_Zju9KB5Y'
    );

    // ── Theme ──
    let isDarkMode = false;

    function applyTheme() {
      const wrapper = document.getElementById('page-wrapper');
      wrapper.classList.remove('bg-gray-50', 'bg-black');
      wrapper.classList.add(isDarkMode ? 'bg-black' : 'bg-gray-50');

      const navClasses = isDarkMode
        ? { bg: 'bg-black', text: 'text-white', shadow: 'shadow-md', logo: 'logo_white.png' }
        : { bg: 'bg-navlight', text: 'text-black', shadow: 'shadow-lg', logo: 'logo_black.png' };

      ['desktop-nav', 'mobile-nav', 'mobile-menu'].forEach(id => {
        const el = document.getElementById(id);
        el.classList.remove('bg-navlight', 'bg-black', 'text-black', 'text-white', 'shadow-lg', 'shadow-md');
        el.classList.add(navClasses.bg, navClasses.text, navClasses.shadow);
      });
      const dd = document.getElementById('desktop-dropdown');
      dd.classList.remove('bg-navlight', 'bg-black', 'text-black', 'text-white');
      dd.classList.add(navClasses.bg, navClasses.text);

      document.getElementById('desktop-logo').src = navClasses.logo;
      document.getElementById('mobile-logo').src = navClasses.logo;
      document.getElementById('sun-icon-desktop').classList.toggle('hidden', !isDarkMode);
      document.getElementById('moon-icon-desktop').classList.toggle('hidden', isDarkMode);
      document.getElementById('sun-icon-mobile').classList.toggle('hidden', !isDarkMode);
      document.getElementById('moon-icon-mobile').classList.toggle('hidden', isDarkMode);

      // Toggle dark class on html for Tailwind dark: prefix
      document.documentElement.classList.toggle('dark', isDarkMode);

      if (window._memberData) renderProfile(window._memberData);
    }

    function toggleTheme() { isDarkMode = !isDarkMode; applyTheme(); }
    document.getElementById('theme-toggle-desktop').addEventListener('click', toggleTheme);
    document.getElementById('theme-toggle-mobile').addEventListener('click', toggleTheme);

    // ── Navbar interactions ──
    const ddBtn = document.getElementById('desktop-dropdown-btn');
    const ddEl = document.getElementById('desktop-dropdown');
    const ddChevron = document.getElementById('desktop-chevron');
    ddBtn.addEventListener('click', () => { const o = !ddEl.classList.contains('hidden'); ddEl.classList.toggle('hidden'); ddChevron.classList.toggle('rotate-180', !o); });
    document.addEventListener('pointerdown', (e) => { if (!document.getElementById('desktop-dropdown-wrapper').contains(e.target)) { ddEl.classList.add('hidden'); ddChevron.classList.remove('rotate-180'); } });

    let mobileOpen = false;
    const mobileMenu = document.getElementById('mobile-menu');
    const menuIcon = document.getElementById('menu-icon');
    const closeIcon = document.getElementById('close-icon');
    function setMobileMenu(o) { mobileOpen=o; mobileMenu.classList.toggle('hidden',!o); menuIcon.classList.toggle('hidden',o); closeIcon.classList.toggle('hidden',!o); if(!o){document.getElementById('mobile-research-links').classList.add('hidden');document.getElementById('mobile-chevron').classList.remove('rotate-180');} }
    document.getElementById('mobile-menu-btn').addEventListener('click', () => setMobileMenu(!mobileOpen));
    document.getElementById('mobile-research-btn').addEventListener('click', () => {
      const rl = document.getElementById('mobile-research-links'); const o = rl.classList.contains('hidden');
      rl.classList.toggle('hidden',!o); document.getElementById('mobile-chevron').classList.toggle('rotate-180',o);
    });
    document.querySelectorAll('.mobile-link').forEach(l => l.addEventListener('click', () => setMobileMenu(false)));
    document.addEventListener('pointerdown', (e) => { if (mobileOpen && !mobileMenu.contains(e.target) && !e.target.closest('.mobile-menu-button')) setMobileMenu(false); });

    // ── SVG icons ──
    const icons = {
      mail: `<svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M22 4l-10 8L2 4"/></svg>`,
      linkedin: `<svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-4 0v7h-4v-7a6 6 0 0 1 6-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg>`,
      globe: `<svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>`,
      arrowLeft: `<svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>`,
      heart: `<svg class="w-5 h-5 text-red-600 dark:text-red-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>`,
      gradCap: `<svg class="w-5 h-5 text-red-600 dark:text-red-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></svg>`,
      bookOpen: `<svg class="w-5 h-5 text-red-600 dark:text-red-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>`,
      globeSm: `<svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>`,
    };

    function esc(s) { const d = document.createElement('div'); d.textContent = s || ''; return d.innerHTML; }

    // ── Render profile ──
    function renderProfile(m) {
      const container = document.getElementById('profile-content');
      const aboutText = m.full_bio || m.bio || '';
      const hobbies = Array.isArray(m.hobbies) ? m.hobbies : [];
      const interests = Array.isArray(m.interests) ? m.interests : [];
      const education = Array.isArray(m.education) ? m.education : [];
      const pubs = Array.isArray(m.publications) ? m.publications : [];
      const linksObj = (m.links && typeof m.links === 'object' && !Array.isArray(m.links)) ? m.links : {};
      const hasExtras = hobbies.length || interests.length || education.length || pubs.length || m.linkedin || m.website || Object.keys(linksObj).length;

      // Build extra links HTML
      let extraLinksHtml = '';
      if (Object.keys(linksObj).length) {
        extraLinksHtml = `<div class="mt-8 pt-6 border-t border-gray-200 dark:border-gray-800 space-y-3">
          ${Object.entries(linksObj).filter(([,v]) => v).map(([k,v]) => {
            const label = k.replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
            return `<a href="${esc(String(v))}" target="_blank" rel="noopener noreferrer" class="flex items-center gap-3 text-sm text-gray-700 dark:text-gray-300 hover:text-red-600 dark:hover:text-red-500 transition-colors">${icons.globeSm} ${esc(label)}</a>`;
          }).join('')}
        </div>`;
      }

      // Contact card HTML
      const contactCard = `
        <div class="bg-white dark:bg-gray-900/50 backdrop-blur-sm border border-gray-200 dark:border-gray-800 rounded-3xl p-8 shadow-lg">
          <h3 class="text-xl font-semibold text-black dark:text-white mb-6">Contact</h3>
          <div class="space-y-5">
            ${m.email ? `<a href="mailto:${esc(m.email)}" class="flex items-center gap-4 text-gray-700 dark:text-gray-300 hover:text-red-600 dark:hover:text-red-500 transition-colors">${icons.mail}<span class="text-base">${esc(m.email)}</span></a>` : ''}
            ${m.linkedin ? `<a href="${esc(m.linkedin)}" target="_blank" rel="noopener noreferrer" class="flex items-center gap-4 text-gray-700 dark:text-gray-300 hover:text-red-600 dark:hover:text-red-500 transition-colors">${icons.linkedin}<span class="text-base">LinkedIn</span></a>` : ''}
            ${m.website ? `<a href="${esc(m.website)}" target="_blank" rel="noopener noreferrer" class="flex items-center gap-4 text-gray-700 dark:text-gray-300 hover:text-red-600 dark:hover:text-red-500 transition-colors">${icons.globe}<span class="text-base">Website</span></a>` : ''}
          </div>
          ${extraLinksHtml}
        </div>`;

      // Tags helper
      const tags = (arr, prefix) => arr.map((x, i) =>
        `<span class="px-3 py-1 rounded-full text-sm border border-gray-200 dark:border-gray-800 text-gray-700 dark:text-gray-300">${esc(x)}</span>`
      ).join('');

      // Interests & Hobbies section
      let interestsHtml = '';
      if (interests.length || hobbies.length) {
        interestsHtml = `
          <div class="bg-white dark:bg-gray-900/50 border border-gray-200 dark:border-gray-800 rounded-3xl p-8">
            <div class="flex items-center gap-3 mb-5">${icons.heart}<h3 class="text-xl font-semibold text-black dark:text-white">Interests & Hobbies</h3></div>
            ${interests.length ? `<div class="mb-5"><p class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-2">Interests</p><div class="flex flex-wrap gap-2">${tags(interests)}</div></div>` : ''}
            ${hobbies.length ? `<div><p class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-2">Hobbies</p><div class="flex flex-wrap gap-2">${tags(hobbies)}</div></div>` : ''}
          </div>`;
      }

      // Education section
      let educationHtml = '';
      if (education.length) {
        educationHtml = `
          <div class="bg-white dark:bg-gray-900/50 border border-gray-200 dark:border-gray-800 rounded-3xl p-8">
            <div class="flex items-center gap-3 mb-5">${icons.gradCap}<h3 class="text-xl font-semibold text-black dark:text-white">Education</h3></div>
            <div class="space-y-4">
              ${education.map(ed => {
                const degree = ed?.degree || ''; const school = ed?.school || ''; const year = ed?.year || '';
                return `<div class="border-l-4 border-gray-200 dark:border-gray-800 pl-4">
                  <p class="text-base font-medium text-gray-900 dark:text-gray-100">${esc([degree, school].filter(Boolean).join(' • ') || '—')}</p>
                  ${year ? `<p class="text-sm text-gray-600 dark:text-gray-400">${esc(year)}</p>` : ''}
                </div>`;
              }).join('')}
            </div>
          </div>`;
      }

      // Publications section
      let pubsHtml = '';
      if (pubs.length) {
        pubsHtml = `
          <div class="bg-white dark:bg-gray-900/50 border border-gray-200 dark:border-gray-800 rounded-3xl p-8">
            <div class="flex items-center gap-3 mb-5">${icons.bookOpen}<h3 class="text-xl font-semibold text-black dark:text-white">Selected Publications</h3></div>
            <div class="space-y-4">
              ${pubs.map(p => {
                const title = p?.title || 'Untitled'; const year = p?.year || ''; const link = p?.link || '';
                return `<div class="border-l-4 border-gray-200 dark:border-gray-800 pl-4">
                  <p class="text-base text-gray-900 dark:text-gray-100">${esc(title)}${year ? `<span class="text-sm text-gray-600 dark:text-gray-400"> • ${esc(year)}</span>` : ''}</p>
                  ${link ? `<a href="${esc(link)}" target="_blank" rel="noopener noreferrer" class="text-sm text-red-700 dark:text-red-500 hover:underline">View link</a>` : ''}
                </div>`;
              }).join('')}
            </div>
          </div>`;
      }

      const imgSrc = m.image || 'images/avatar.png';

      container.innerHTML = `
        <!-- Back Button -->
        <a href="teams.html" class="inline-flex items-center gap-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-black dark:hover:text-white mb-10 transition-colors">
          ${icons.arrowLeft} Back to Team
        </a>

        <!-- Mobile: Image First -->
        <div class="md:hidden mb-12">
          <div class="relative aspect-[4/5] rounded-3xl overflow-hidden shadow-2xl border border-gray-200 dark:border-gray-800">
            <img src="${esc(imgSrc)}" alt="${esc(m.name)}" class="absolute inset-0 w-full h-full object-cover" />
          </div>
        </div>

        <!-- Main Grid -->
        <div class="grid md:grid-cols-[380px_1fr] lg:grid-cols-[420px_1fr] gap-12 lg:gap-20 items-start">

          <!-- Left: Photo + Contact -->
          <div class="order-2 md:order-1 md:sticky md:top-24 space-y-8">
            <!-- Desktop Photo -->
            <div class="hidden md:block relative aspect-[4/5] rounded-3xl overflow-hidden shadow-2xl border border-gray-200 dark:border-gray-800">
              <img src="${esc(imgSrc)}" alt="${esc(m.name)}" class="absolute inset-0 w-full h-full object-cover" />
            </div>
            ${contactCard}
          </div>

          <!-- Right: Content -->
          <div class="order-1 md:order-2">
            <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-black dark:text-white leading-tight">${esc(m.name)}</h1>
            ${m.title ? `<p class="mt-4 text-2xl md:text-3xl font-medium text-red-700 dark:text-red-500">${esc(m.title)}</p>` : ''}

            ${aboutText ? `<div class="mt-10"><p class="text-lg md:text-xl leading-relaxed text-gray-700 dark:text-gray-300 whitespace-pre-line">${esc(aboutText)}</p></div>` : ''}

            ${hasExtras ? `<div class="mt-12 space-y-8">${interestsHtml}${educationHtml}${pubsHtml}</div>` : ''}

            <!-- Mobile Contact Repeat -->
            <div class="md:hidden mt-12">${contactCard}</div>
          </div>
        </div>
      `;
    }

    // ── Fetch member ──
    async function init() {
      const slug = new URLSearchParams(window.location.search).get('slug');
      if (!slug) {
        document.getElementById('loading-state').classList.add('hidden');
        document.getElementById('error-state').classList.remove('hidden');
        return;
      }

      try {
        const { data, error } = await supabase
          .from('team_members')
          .select('id,slug,name,title,email,image,bio,full_bio,linkedin,website,hobbies,interests,education,publications,links,extra')
          .eq('slug', slug)
          .maybeSingle();

        if (error) throw error;
        if (!data) {
          document.getElementById('loading-state').classList.add('hidden');
          document.getElementById('error-state').classList.remove('hidden');
          return;
        }

        window._memberData = data;
        document.title = `${data.name} | AIR Lab • NCSU`;

        document.getElementById('loading-state').classList.add('hidden');
        document.getElementById('profile-content').classList.remove('hidden');
        renderProfile(data);
      } catch (err) {
        document.getElementById('loading-state').classList.add('hidden');
        document.getElementById('error-state').classList.remove('hidden');
        document.getElementById('error-message').textContent = 'Error: ' + (err.message || 'Failed to load member');
      }
    }

    init();
    applyTheme();
  </script>
</body>
</html>
